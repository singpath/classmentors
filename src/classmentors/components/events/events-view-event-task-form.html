<md-content flex class="md-padding">
    <form name="editTask" ng-submit="ctrl.saveTask(ctrl.event, ctrl.taskId, ctrl.task, ctrl.taskType, ctrl.isOpen, editTask)">
        <div>
            <div layout="row">
                <md-input-container flex>
                    <label for="edit-task-name">Name</label>
                    <input type="text" name="editTaskTitle" id="edit-task-name"

                        ng-model="ctrl.task.title"
                        required="required" ng-minLength="3" md-maxLength="30"
                        placeholder="Challenge name"

                    />

                    <div ng-messages="editTask.editTaskTitle.$error">
                        <div ng-message="required">A challenge needs a name.</div>
                        <div ng-message="minlength">The name is too short.</div>
                        <div ng-message="md-maxlength">The name is too long.</div>
                    </div>
                </md-input-container>
                <md-input-container flex>
                    <label for="edit-task-priority">Priority</label>
                    <input type="number" name="editTaskPriority" id="edit-task-priority"

                        ng-model="ctrl.task.priority"
                        min="0" step="1"
                        placeholer="Challenge priority"

                    />
                    <div ng-messages="editTask.editTaskPriority.$error">
                        <div ng-message="number">The priority should be a positive number.</div>
                    </div>
                </md-input-container>
            </div>
        </div>

        <div>
            <md-input-container class="md-block" flex>
                <label for="edit-task-desc">Description</label>
                <textarea name="editTaskDesc" id="edit-task-desc"
                    ng-model="ctrl.task.description"
                    required="required" ng-minLength="3" md-maxLength="200"
                    placeholder="Challenge description"
                >{{ctrl.task.description}}</textarea>


                <div ng-messages="editTask.editTaskDesc.$error">
                    <div ng-message="required">A challenge needs a description.</div>
                    <div ng-message="minlength">The description is too short.</div>
                    <div ng-message="md-maxlength">The description is too long.</div>
                </div>
            </md-input-container>
        </div>

        <div>
            <md-input-container>
                <label for="edit-task-link">Help Link</label>
                <input type="text" name="editTaskLink" id="edit-task-link"

                    ng-model="ctrl.task.link"
                    pattern="^(https?://.+|#/).+$"
                    placeholder="URL to a challenge help page"

                />
                <div ng-messages="editTask.editTaskLink.$error">
                    <div ng-message="pattern">Wrong format for an absolute or relative URL.</div>
                </div>
            </md-input-container>
        </div>

        <div>
            <h3>options</h3>
            <p>
                <md-switch class="md-primary" ng-model="ctrl.isOpen" aria-label="closed?">
                    Open
                </md-switch>
            </p>
            <p>
                <md-switch class="md-primary" ng-model="ctrl.task.hidden" aria-label="hidden?">
                    Hide
                </md-switch>
            </p>

            <p>
                <md-switch class="md-primary" ng-model="ctrl.task.archived" aria-label="Archived?">
                    Archived
                </md-switch>
            </p>

            <p>
                <md-switch class="md-primary" ng-model="ctrl.task.showProgress" aria-label="show progress?">
                    Show all participant progress.
                </md-switch>
            </p>

            <p>
                <md-switch class="md-primary" ng-model="ctrl.task.showLinks" aria-label="closed?">
                    Show all participant solutions.
                </md-switch>
            </p>

        </div>

        <div>
            <h3>Task type <small ng-if="!ctrl.taskType">(Required)</small></h3>
            <md-radio-group ng-model="ctrl.taskType" layout="row" layout-wrap>
                <md-radio-button flex="100" flex-gt-xs="50" flex-gt-md="33" value="service" class="md-primary">Service / Achievements</md-radio-button>
                <md-radio-button flex="100" flex-gt-xs="50" flex-gt-md="33" value="linkPattern" class="md-primary">Link pattern</md-radio-button>
                <md-radio-button flex="100" flex-gt-xs="50" flex-gt-md="33" value="textResponse" class="md-primary">Text Response</md-radio-button>
                <md-radio-button flex="100" flex-gt-xs="50" flex-gt-md="33" value="multipleChoice" class="md-primary">Multiple Choice</md-radio-button>
                <md-radio-button flex="100" flex-gt-xs="50" flex-gt-md="33" value="code" class="md-primary">Code</md-radio-button>
                <md-radio-button flex="100" flex-gt-xs="50" flex-gt-md="33" value="profileEdit" class="md-primary">Profile Update</md-radio-button>
                <md-radio-button flex="100" flex-gt-xs="50" flex-gt-md="33" value="video" class="md-primary">Video</md-radio-button>
                <md-radio-button flex="100" flex-gt-xs="50" flex-gt-md="33" value="journalling" class="md-primary">Journalling</md-radio-button>
                <md-radio-button flex="100" flex-gt-xs="50" flex-gt-md="33" value="survey" class="md-primary">Survey</md-radio-button>
                <md-radio-button flex="100" flex-gt-xs="50" flex-gt-md="33" value="teamActivity" class="md-primary">Team Activity</md-radio-button>
            </md-radio-group>
        </div>

        <div ng-if="ctrl.taskType == 'service'">
            <md-input-container flex layout="column">
                <label for="editTaskServiceIdID">Select a Service</label>
                <md-select flex id="editTaskServiceIdID" name="editTaskServiceId" ng-model="ctrl.task.serviceId" required>
                    <md-option value="singPath">SingPath</md-option>
                    <md-option ng-value="service.serviceId" ng-repeat="service in ctrl.services" ng-if="service.available">
                        {{service.name}}
                    </md-option>
                </md-select>
                <div ng-messages="editTask.editTaskServiceId.$error">
                    <div ng-message="required">A challenge needs a service id.</div>
                </div>
            </md-input-container>
        </div>

        <div ng-if="ctrl.task.serviceId">
            <h3>Select a requirement type</h3>
            <md-radio-group ng-model="ctrl.serviceTaskType" ng-change="ctrl.serviceTaskTypeChanged(ctrl.serviceTaskType, ctrl.task)">
                <md-radio-button value="register" class="md-primary">Register Only.</md-radio-button>
                <md-radio-button value="minTotalAchievements" class="md-primary">A number of achievements.</md-radio-button>
                <md-radio-button value="badge" class="md-primary">A specific badge / achievement.</md-radio-button>
            </md-radio-group>
        </div>

        <div layout ng-if="ctrl.serviceTaskType == 'minTotalAchievements'">
            <md-input-container flex>
                <label for="edit-task-min-total-achievements">Minimum number of achievements</label>
                <input type="number" name="editTaskMinTotalAchievements" id="edit-task-min-total-achievements"
                    ng-model="ctrl.task.minTotalAchievements"
                    step="1"
                    min="1"
                />

                <div ng-messages="editTask.editTaskMinTotalAchievements.$error">
                    <div ng-message="required">A challenge needs a name.</div>
                    <div ng-message="min">You require at least 1 badge / achievement.</div>
                </div>
            </md-input-container>
        </div>

        <div layout ng-if="ctrl.serviceTaskType == 'badge' && ctrl.task.serviceId != 'singPath'">
            <md-input-container flex layout="column">
                <label for="editTaskBadgeID">Select a badge</label>
                <md-select flex id="editTaskBadgeID" name="editTaskBadge" ng-model="ctrl.task.badge">
                    <md-option ng-value="badge" ng-repeat="badge in ctrl.badges[ctrl.task.serviceId]">
                        {{badge.name}}
                    </md-option>
                </md-select>
            </md-input-container>
        </div>

        <div layout="row" ng-if="ctrl.serviceTaskType == 'badge' && ctrl.task.serviceId == 'singPath'">
            <md-input-container flex layout="column">
                <label for="editTaskSingPathPathID">Select a Path</label>
                <md-select flex id="editTaskSingPathPathID" name="editTaskSingPathPath"
                           ng-model="ctrl.task.singPathProblem.path"
                           placeholder="Select a Path (optional)"
                >
                    <md-option ng-value="opt" ng-repeat="opt in ctrl.singPath.paths">
                        {{opt.title}}
                    </md-option>
                </md-select>
            </md-input-container>
            <md-input-container flex layout="column" ng-if="ctrl.task.singPathProblem.path">
                <label for="editTaskSingPathLevelID">Select a Level</label>
                <md-select flex id="editTaskSingPathLevelID" name="editTaskSingPathLevel"
                           ng-model="ctrl.task.singPathProblem.level"
                           required
                           md-on-open="ctrl.loadLevels(ctrl.task.singPathProblem)"
                >
                    <md-option ng-value="opt" ng-repeat="opt in ctrl.singPath.levels">
                        {{opt.title}}
                    </md-option>
                </md-select>
                <div ng-messages="editTask.editTaskSingPathLevel.$error">
                    <div ng-message="required">A challenge needs a service id.</div>
                </div>
            </md-input-container>
            <md-input-container flex layout="column" ng-if="ctrl.task.singPathProblem.level">
                <label for="editTaskSingPathProblemID">Select a Problem</label>
                <md-select flex id="editTaskSingPathProblemID" name="editTaskSingPathProblem"
                           ng-model="ctrl.task.singPathProblem.problem"
                           required
                           md-on-open="ctrl.loadProblems(ctrl.task.singPathProblem)"
                >
                    <md-option ng-value="opt" ng-repeat="opt in ctrl.singPath.problems">
                        {{opt.title}}
                    </md-option>
                </md-select>
                <div ng-messages="editTask.editTaskSingPathProblem.$error">
                    <div ng-message="required">A challenge needs a service id.</div>
                </div>
            </md-input-container>
        </div>

        <div ng-if="ctrl.taskType == 'linkPattern'">
            <md-input-container>
                <label for="edit-link-pattern">Link pattern</label>
                <input type="text" name="editTaskLink" id="edit-link-pattern"

                    ng-model="ctrl.task.linkPattern"
                    required="true"
                    placeholer="Pattern"

                />

                <div ng-messages="editTask.editTaskLink.$error">
                    <div ng-message="required">Required.</div>
                </div>
            </md-input-container>
        </div>

        <div ng-if="ctrl.taskType == 'textResponse'">
            <md-input-container>

                <label for="edit-text-response">Question</label>
                <input type="text" name="editTextResponse" id="edit-text-response"
                    ng-model="ctrl.task.textResponse"
                    required="true"
                    placeholer="Question"

                />

                <div ng-messages="editTask.editTextResponse.$error">
                    <div ng-message="required">Required.</div>
                </div>
            </md-input-container>
        </div>

        <div ng-if="ctrl.taskType == 'indexCard'">
            <md-input-container flex>
                <label for="edit-max-cards">Maximum cards allowed</label>
                <input type="number" name="editMaxCards" id="edit-max-cards"
                       ng-model="ctrl.task.cards"
                       min="0" step="1"
                       placeholer="index Cards"
                />
                <div ng-messages="editTask.editTaskPriority.$error">
                    <div ng-message="number">The max cards allowed should be a positive number.</div>
                </div>
            </md-input-container>
        </div>


        <div ng-if="ctrl.taskType == 'code'">
            <md-input-container>
                <label for="edit-text-response">Question</label>
                <input type="text" name="editCodeQuestion" id="edit-code-question"
                       ng-model="ctrl.task.textResponse"
                       required
                       placeholder="Question"
                />

                <div ng-messages="editTask.editCodeQuestion.$error">
                    <div ng-message="required">Required.</div>
                </div>
            </md-input-container>
            <md-input-container flex layout="column">
                <md-select flex name="editCodeLang"
                           ng-model="ctrl.task.lang" required placeholder="Select a Language">
                    <md-option ng-value="opt" ng-repeat="opt in ['Java', 'Javascript', 'HTML', 'Python']">
                        {{opt}}
                    </md-option>
                </md-select>
            </md-input-container>
        </div>

        <div ng-if="ctrl.taskType == 'video'">
            <md-input-container>
                Video
            </md-input-container>
        </div>

        <div ng-if="ctrl.taskType == 'journalling'">
            <md-input-container>
                Journalling
            </md-input-container>
        </div>

        <div ng-if="ctrl.taskType == 'profileEdit'">
            Select fields for participants to edit:
            <md-list  ng-repeat="metaData in ['Year of Birth', 'School']">
                <md-checkbox ng-checked="ctrl.exists(metaData, ctrl.selectedMetaData)" ng-click="ctrl.toggle(metaData, ctrl.selectedMetaData)">
                    {{metaData}}</br>
                </md-checkbox>
            </md-list>
        </div>

        <div layout="row" layout-align="center center">
            <!--TODO: 1. Create continue button controller to route to other views depending on challenge type-->

            <md-button type="submit" class="md-raised md-primary" ng-disabled="editTask.$invalid || !ctrl.taskType ||ctrl.savingTask">{{ ctrl.challengeRouteProvider(ctrl.taskType, ctrl.task, ctrl.isOpen)}}</md-button>
            <md-button type="reset" class="md-raised" ng-click="ctrl.discardChanges($event)">Back</md-button>

        </div>
    </form>
</md-content>

